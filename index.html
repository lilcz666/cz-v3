<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemini V5 [iOS Ultimate]</title>
    <style>
        :root {
            --bg: #eef2f5;
            --text: #4a5568;
            --text-light: #a0aec0;
            --primary: #3182ce; /* iOS Blue */
            --red: #e53e3e;
            --green: #38a169;
            --shadow-light: -6px -6px 12px #ffffff;
            --shadow-dark: 6px 6px 12px #d1d9e6;
            --inner-shadow: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff;
            --radius: 20px;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .container { width: 100%; max-width: 414px; display: flex; flex-direction: column; gap: 24px; }

        /* é¡¶éƒ¨å¯¼èˆª */
        .nav-bar { display: flex; justify-content: space-between; align-items: center; padding: 0 5px; }
        .logo { font-weight: 800; font-size: 1.1rem; color: var(--text); letter-spacing: -0.5px; }
        .status-badge { 
            background: var(--bg); padding: 6px 12px; border-radius: 20px; 
            box-shadow: var(--shadow-dark), var(--shadow-light);
            font-size: 0.75rem; font-weight: 600; color: var(--green); display: flex; align-items: center; gap: 6px;
        }
        .dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; box-shadow: 0 0 8px var(--green); }

        /* æ–°æ‹Ÿæ€å¡ç‰‡ */
        .neu-card {
            background: var(--bg); border-radius: var(--radius);
            box-shadow: var(--shadow-dark), var(--shadow-light);
            padding: 24px; position: relative;
        }
        .neu-inset {
            border-radius: 12px;
            box-shadow: var(--inner-shadow);
            padding: 15px; background: var(--bg);
        }

        /* æ ¸å¿ƒé¢„æµ‹åŒº */
        .hero-section { text-align: center; }
        .issue-tag { font-size: 0.85rem; color: var(--text-light); margin-bottom: 15px; font-weight: 500; }
        
        .main-dial {
            width: 160px; height: 160px; margin: 0 auto;
            border-radius: 50%;
            box-shadow: var(--shadow-dark), var(--shadow-light);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
        }
        .dial-inner {
            width: 120px; height: 120px; border-radius: 50%;
            box-shadow: var(--inner-shadow);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .pred-val { font-size: 3rem; font-weight: 800; color: var(--text); line-height: 1; }
        .pred-conf { font-size: 0.7rem; color: var(--text-light); margin-top: 5px; }

        /* æˆ˜æœ¯é¢æ¿ (Main/Def/Kill) */
        .tac-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .tac-box { 
            background: var(--bg); padding: 15px; border-radius: 16px; 
            box-shadow: var(--shadow-dark), var(--shadow-light); text-align: center; 
        }
        .tac-title { font-size: 0.7rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .tac-data { font-weight: 700; font-size: 1rem; color: var(--text); }
        .kill-zone { 
            grid-column: 1 / -1; margin-top: 5px; padding: 12px;
            color: #a0aec0; text-decoration: line-through; display: flex; justify-content: center; align-items: center; gap: 10px;
        }

        /* æƒé‡æ¡ */
        .bars-container { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .bar-wrap { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        .track { flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1); }
        .fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }

        /* å†å²åˆ—è¡¨ */
        .hist-list { margin-top: 10px; max-height: 300px; overflow-y: auto; padding-right: 5px; }
        .hist-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.85rem; 
        }
        .res-pill { 
            padding: 4px 10px; border-radius: 12px; font-weight: 700; font-size: 0.75rem; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }
        .hit { background: rgba(56, 161, 105, 0.15); color: var(--green); }
        .miss { background: rgba(229, 62, 62, 0.15); color: var(--red); }

        /* é¢œè‰²ç±» */
        .c-red { color: var(--red); }
        .c-green { color: var(--green); }
        .c-blue { color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    
    <div class="nav-bar">
        <div class="logo">GEMINI V5.0</div>
        <div class="status-badge">
            <div class="dot" id="liveDot"></div>
            <span id="countdown">LOADING...</span>
        </div>
    </div>

    <div class="neu-card hero-section">
        <div class="issue-tag">Target Issue: <span id="targetIssue" class="c-blue">--</span></div>
        
        <div class="main-dial">
            <div class="dial-inner">
                <div id="mainPred" class="pred-val">--</div>
                <div id="confidence" class="pred-conf">Calculating...</div>
            </div>
        </div>

        <div class="tac-grid">
            <div class="tac-box">
                <div class="tac-title">ğŸ”¥ MAIN ATTACK</div>
                <div id="tacMain" class="tac-data c-red">--</div>
            </div>
            <div class="tac-box">
                <div class="tac-title">ğŸ›¡ï¸ DEFENSE</div>
                <div id="tacDef" class="tac-data c-green">--</div>
            </div>
            <div class="tac-box kill-zone">
                <span style="font-size:0.7rem; font-weight:bold; color:#718096; text-decoration:none;">ğŸ’€ KILL ZONE</span>
                <span id="tacKill">--</span>
            </div>
        </div>

        <div class="bars-container">
            <div class="bar-wrap">
                <span style="width:25px; font-weight:bold;">Big</span>
                <div class="track"><div id="barBig" class="fill" style="background:var(--red); width:0%"></div></div>
                <span id="valBig">0</span>
            </div>
            <div class="bar-wrap">
                <span style="width:25px; font-weight:bold;">Sml</span>
                <div class="track"><div id="barSml" class="fill" style="background:var(--green); width:0%"></div></div>
                <span id="valSml">0</span>
            </div>
            <div class="bar-wrap">
                <span style="width:25px; font-weight:bold;">Odd</span>
                <div class="track"><div id="barOdd" class="fill" style="background:var(--primary); width:0%"></div></div>
                <span id="valOdd">0</span>
            </div>
            <div class="bar-wrap">
                <span style="width:25px; font-weight:bold;">Evn</span>
                <div class="track"><div id="barEvn" class="fill" style="background:#d69e2e; width:0%"></div></div>
                <span id="valEvn">0</span>
            </div>
        </div>
    </div>

    <div class="neu-card">
        <div style="font-size:0.9rem; font-weight:700; color:var(--text); margin-bottom:10px;">HISTORY & REVIEW</div>
        <div id="histList" class="hist-list">
            <div style="text-align:center; padding:20px; color:#a0aec0;">Syncing Data...</div>
        </div>
    </div>

</div>

<script>
    // --- V5.0 ç»ˆæå¸¸é‡ (ä¸¥æ ¼ä¿ç•™ 1-14 æ®µ) ---
    const C = {
        SQRT_OSC: 28.5, SQRT_ADD: 7.5515, FISS_GOLD: 1.6180, SCAL_GOLD: 3.81966,
        TRI_DIV: 42.75, REV_GOLD: 0.61803, WARN_DIV: 6.6666, EXT_DIV: 2.2222
    };

    // --- å…¨å±€çŠ¶æ€ ---
    const STATE = {
        api: "https://pc28.help/kj.json?limit=50", // å¼ºåˆ¶50æœŸ
        history: [],
        refresh: 20
    };

    // --- ç®—æ³•å†…æ ¸ (KERNEL) ---
    const KERNEL = {
        // è¾…åŠ©
        getD: (n) => parseInt(n.toFixed(6).split('.')[1][0]),
        
        // è¿ç®—åˆé›†
        run: (n1, n2, n3, sum) => {
            let w = { b:0, s:0, o:0, e:0 };
            let log = [];

            // Algo 19 (P0 æ‰‹æœ¯åˆ€)
            let r19 = (Math.sqrt(n1**2 + n2**2 + n3**2)) / C.SCAL_GOLD;
            let d19 = KERNEL.getD(r19);
            if([7,8,9].includes(d19)) w.b+=10; 
            else if([0,1,2].includes(d19)) w.s+=10;
            if([3,4,5,6].includes(d19)) { ((Math.floor(r19)+n1+n2)%3===0) ? w.o+=10 : w.e+=10; }

            // Algo 16 (P1 å‡ ä½•) - è·³æ°´åˆ¤å®š
            let isDiving = Math.abs(n1-n2)>8;
            let r16 = Math.sqrt(n1*n2*(1+Math.abs(n1-n2)/C.SQRT_OSC)+C.SQRT_ADD);
            let d16 = KERNEL.getD(r16);
            let score16 = isDiving ? 10 : 5; // ç‹¬è£æƒè§¦å‘
            (d16>=5) ? w.b+=score16 : w.s+=score16;

            // Algo 14 (P1 è£‚å˜) - N4=Sum
            let r14 = Math.sqrt(((n1-n2)**2) + ((n3**2)/(sum+1)) + C.FISS_GOLD);
            let d14 = KERNEL.getD(r14);
            // 0-4é¡º, 5-9è£‚ (ç®€åŒ–å€¾å‘)
            if(d14<=4) { /* é¡ºåŠ¿åŠ æˆ */ if(w.b>w.s) w.b+=2; else w.s+=2; }

            // Algo 18 (P2 åŠ¨é‡)
            let r18 = ((n1+3.1415)*(n2+2.7182)*(n3+1.4142))/C.TRI_DIV;
            let u18 = Math.floor(r18)%10;
            (u18%2!==0) ? w.o+=3 : w.e+=3;

            // Algo 10 (P4 ä¿®æ­£) - N1ç‰ˆ
            let r10 = 280 / (n1 + C.EXT_DIV);
            let dec10 = r10 - Math.floor(r10);
            if(dec10 < 0.333) { // åå¼¹
                if(w.b>w.s) w.s+=4; else w.b+=4; // å¼ºåŠ›é˜²å®ˆ
            }

            // ç›²åŒºæ ¡å‡† (14æ®µ)
            let maxS = Math.max(w.b,w.s,w.o,w.e);
            if(maxS>=7.5 && maxS<=8.5) {
                let kill = (Math.floor(r19)+n1+n2)%3;
                if(kill===0) w.o+=5; else w.e+=5;
            }

            // ç»„åˆè®¡ç®—
            let combos = [
                { name: "å¤§å•", s: w.b+w.o }, { name: "å¤§åŒ", s: w.b+w.e },
                { name: "å°å•", s: w.s+w.o }, { name: "å°åŒ", s: w.s+w.e }
            ];
            combos.sort((a,b) => b.s - a.s);

            return { w, combos };
        }
    };

    // --- ç³»ç»Ÿé€»è¾‘ ---
    async function sync() {
        document.getElementById('countdown').innerText = "SYNC...";
        try {
            // å¼ºåˆ¶ä¸ç¼“å­˜
            const t = Date.now();
            const url = `https://api.allorigins.win/get?url=${encodeURIComponent(STATE.api + "&t=" + t)}`;
            const res = await fetch(url);
            const json = await res.json();
            const data = JSON.parse(json.contents).data;

            if(data && data.length > 0) {
                // æ ¼å¼åŒ–æ•°æ® (APIæ˜¯å€’åº: æœ€æ–°åœ¨[0])
                STATE.history = data.map(item => {
                    const nums = item.opennum.split('+').map(Number);
                    return {
                        q: item.qihao,
                        n1: nums[0], n2: nums[1], n3: nums[2], sum: parseInt(item.sum)
                    };
                });
                render();
            }
        } catch(e) {
            console.error(e);
        }
        startTimer();
    }

    function render() {
        const list = STATE.history;
        if(list.length < 2) return;

        // 1. é¢„æµ‹ä¸‹ä¸€æœŸ (åŸºäº list[0])
        const cur = list[0];
        const nextQ = BigInt(cur.q) + 1n;
        const result = KERNEL.run(cur.n1, cur.n2, cur.n3, cur.sum);
        
        // UI: æ ¸å¿ƒ
        document.getElementById('targetIssue').innerText = nextQ;
        const mainCombo = result.combos[0];
        document.getElementById('mainPred').innerText = mainCombo.name.charAt(0); // å¤§/å°
        document.getElementById('confidence').innerText = `Confidence: ${Math.min(99, mainCombo.s*4).toFixed(0)}%`;

        // UI: æˆ˜æœ¯é¢æ¿
        document.getElementById('tacMain').innerText = `${result.combos[0].name} / ${result.combos[1].name}`;
        document.getElementById('tacDef').innerText = result.combos[2].name; // å¯¹å†²ä½
        document.getElementById('tacKill').innerText = result.combos[3].name; // åºŸç»„

        // UI: æƒé‡æ¡
        const drawBar = (id, val) => {
            const dom = document.getElementById('bar'+id);
            const txt = document.getElementById('val'+id);
            dom.style.width = Math.min(100, val*5) + '%';
            txt.innerText = val.toFixed(0);
        };
        drawBar('Big', result.w.b); drawBar('Sml', result.w.s);
        drawBar('Odd', result.w.o); drawBar('Evn', result.w.e);

        // UI: å†å²å¤ç›˜ (å…³é”®åŠŸèƒ½)
        const histBox = document.getElementById('histList');
        histBox.innerHTML = '';
        
        // éå†å†å²ï¼Œæ˜¾ç¤ºæœ€è¿‘ 15 æœŸ
        // æ³¨æ„ï¼šé¢„æµ‹ list[i] éœ€è¦ç”¨åˆ° list[i+1] çš„æ•°æ®
        for(let i=0; i < Math.min(15, list.length-1); i++) {
            const target = list[i]; // è¿™ä¸€æœŸå®é™…å¼€å‡ºçš„
            const prev = list[i+1]; // ä¸Šä¸€æœŸ (ç”¨æ¥é¢„æµ‹targetçš„)
            
            // è·‘ä¸€éç®—æ³•
            const pastRes = KERNEL.run(prev.n1, prev.n2, prev.n3, prev.sum);
            
            // åˆ¤å®šèƒœè´Ÿ
            const actBs = target.sum >= 14 ? 'å¤§' : 'å°';
            const actOe = target.sum % 2 !== 0 ? 'å•' : 'åŒ';
            const actName = actBs + actOe; // e.g. "å¤§å•"
            
            // åªè¦å‰ä¸¤å(ä¸»æ”»)é‡ŒåŒ…å«å®é™…ç»“æœï¼Œå°±ç®—å‘½ä¸­
            const isHit = (pastRes.combos[0].name === actName || pastRes.combos[1].name === actName);
            
            const row = document.createElement('div');
            row.className = 'hist-item';
            row.innerHTML = `
                <div>
                    <div style="font-weight:700; color:var(--text);">${target.q.slice(-4)}æœŸ</div>
                    <div style="font-size:0.75rem; color:#a0aec0;">${target.n1}+${target.n2}+${target.n3}=${target.sum}</div>
                </div>
                <div style="text-align:right;">
                    <span style="font-weight:700; margin-right:5px; color:#4a5568;">${actName}</span>
                    <span class="res-pill ${isHit?'hit':'miss'}">${isHit?'å‘½ä¸­':'åç¦»'}</span>
                </div>
            `;
            histBox.appendChild(row);
        }
    }

    function startTimer() {
        let t = STATE.refresh;
        const timer = setInterval(() => {
            t--;
            document.getElementById('countdown').innerText = `NEXT: ${t}s`;
            if(t <= 0) {
                clearInterval(timer);
                sync();
            }
        }, 1000);
    }

    // å¯åŠ¨
    window.onload = sync;

</script>
</body>
</html>
