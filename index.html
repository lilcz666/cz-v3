<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemini V7.0 [DICTATOR]</title>
    <style>
        :root {
            --bg: #f0f2f5;
            --text-dark: #1c1c1e;
            --text-gray: #8e8e93;
            --blue: #007aff;
            --green: #34c759;
            --red: #ff3b30;
            --yellow: #ffcc00;
            --shadow: 8px 8px 20px #d1d9e6, -8px -8px 20px #ffffff;
            --inner: inset 5px 5px 10px #d1d9e6, inset -5px -5px 10px #ffffff;
            --radius: 20px;
        }

        body {
            background-color: var(--bg);
            color: var(--text-dark);
            font-family: -apple-system, "SF Pro Text", sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container { width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 24px; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 0 5px; }
        .brand { font-weight: 900; font-size: 1.2rem; letter-spacing: -1px; color: var(--text-dark); }
        .status { 
            padding: 6px 14px; border-radius: 50px; background: #e0e5ec;
            box-shadow: var(--shadow); font-size: 0.7rem; font-weight: 700; color: var(--blue);
            display: flex; align-items: center; gap: 6px;
        }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--blue); animation: pulse 1s infinite; }

        /* Neumorphic Card */
        .card {
            border-radius: var(--radius); background: var(--bg);
            box-shadow: var(--shadow); padding: 24px; position: relative;
        }

        .label { font-size: 0.7rem; font-weight: 800; color: var(--text-gray); letter-spacing: 1px; margin-bottom: 16px; text-transform: uppercase; }

        /* Tactical Rows */
        .tac-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .tac-left { display: flex; align-items: center; gap: 10px; font-weight: 700; color: var(--text-dark); font-size: 0.9rem; }
        .icon { width: 10px; height: 10px; border-radius: 2px; }
        .tac-val { font-size: 1.3rem; font-weight: 900; letter-spacing: -0.5px; }

        /* Weights */
        .bars { display: flex; flex-direction: column; gap: 14px; }
        .bar-wrap { display: flex; align-items: center; justify-content: space-between; font-size: 0.8rem; font-weight: 700; }
        .track { flex: 1; height: 12px; background: #e0e5ec; border-radius: 6px; margin: 0 12px; box-shadow: var(--inner); overflow: hidden; }
        .fill { height: 100%; border-radius: 6px; transition: width 0.4s; }

        /* History */
        .hist-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.85rem; 
        }
        .tag { padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; }
        
        .hit { color: var(--green); background: rgba(52,199,89,0.1); }
        .def { color: #d4a017; background: rgba(255,204,0,0.1); }
        .miss { color: var(--red); background: rgba(255,59,48,0.1); }

        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        
        .c-main { color: var(--blue); }
        .c-def { color: #d4a017; }
        .c-kill { color: var(--text-gray); text-decoration: line-through; opacity: 0.6; }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header">
        <div class="brand">GEMINI V7.0</div>
        <div class="status"><div class="dot"></div> <span id="timer">Loading...</span></div>
    </div>

    <div class="card">
        <div class="label">TACTICAL CORE</div>
        
        <div class="tac-row">
            <div class="tac-left"><div class="icon" style="background:var(--blue)"></div>主攻 (Main)</div>
            <div id="tMain" class="tac-val c-main">--</div>
        </div>

        <div class="tac-row">
            <div class="tac-left"><div class="icon" style="background:var(--yellow)"></div>防守 (Def)</div>
            <div id="tDef" class="tac-val c-def">--</div>
        </div>

        <div class="tac-row" style="margin-bottom:0">
            <div class="tac-left"><div class="icon" style="background:#ccc"></div>杀组 (Kill)</div>
            <div id="tKill" class="tac-val c-kill">--</div>
        </div>
    </div>

    <div class="card">
        <div class="label">ENERGY (10.0 SCALE)</div>
        <div class="bars">
            <div class="bar-wrap"><span>大</span><div class="track"><div id="bBig" class="fill" style="background:var(--red); width:0%"></div></div><span id="vBig">0.0</span></div>
            <div class="bar-wrap"><span>小</span><div class="track"><div id="bSml" class="fill" style="background:var(--green); width:0%"></div></div><span id="vSml">0.0</span></div>
            <div class="bar-wrap"><span>单</span><div class="track"><div id="bOdd" class="fill" style="background:var(--blue); width:0%"></div></div><span id="vOdd">0.0</span></div>
            <div class="bar-wrap"><span>双</span><div class="track"><div id="bEvn" class="fill" style="background:var(--yellow); width:0%"></div></div><span id="vEvn">0.0</span></div>
        </div>
        
        <div style="margin-top:25px; padding-top:20px; border-top:1px solid rgba(0,0,0,0.05);">
            <div class="label" style="margin-bottom:10px">COMBOS</div>
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:5px; text-align:center;">
                <div id="cN1" style="font-size:0.7rem; font-weight:bold; color:var(--blue)">-</div>
                <div id="cN2" style="font-size:0.7rem; font-weight:bold; color:var(--blue)">-</div>
                <div id="cN3" style="font-size:0.7rem; font-weight:bold; color:#d4a017">-</div>
                <div id="cN4" style="font-size:0.7rem; font-weight:bold; color:#aaa; text-decoration:line-through">-</div>
                
                <div id="cV1" style="font-size:0.9rem; font-weight:800;">0.0</div>
                <div id="cV2" style="font-size:0.9rem; font-weight:800;">0.0</div>
                <div id="cV3" style="font-size:0.9rem; font-weight:800;">0.0</div>
                <div id="cV4" style="font-size:0.9rem; font-weight:800; color:#aaa;">0.0</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="label">REVIEW (LAST 10)</div>
        <div id="histList"></div>
    </div>

</div>

<script>
    // --- 1. V5.0 指令集常量 (不可动) ---
    const C = {
        SQRT_OSC: 28.5, SQRT_ADD: 7.5515, FISS_GOLD: 1.6180, SCAL_GOLD: 3.81966,
        TRI_DIV: 42.75, REV_GOLD: 0.61803, WARN_DIV: 6.6666, EXT_DIV: 2.2222
    };

    const STATE = {
        api: "https://pc28.help/kj.json?limit=50",
        history: [],
        refresh: 20
    };

    const KERNEL = {
        getD: (n) => parseInt(n.toFixed(6).split('.')[1][0]),
        
        // --- 2. 核心运算逻辑 (DICTATOR MODE) ---
        run: (n1, n2, n3, sum, prevItem, history) => {
            // 初始底分 (防止0)
            let w = { b:1, s:1, o:1, e:1 }; 
            let logs = [];

            // 状态检测 (第11段)
            let isDive = Math.abs(n1-n2) > 8;
            let isDictator = false;

            // --- P0: Algo 19 (手术刀) ---
            // 规则: D 012小, 789大, 3456熵
            let r19 = (Math.sqrt(n1**2+n2**2+n3**2))/C.SCAL_GOLD;
            let d19 = KERNEL.getD(r19);
            let i19 = Math.floor(r19);
            
            // 独裁逻辑: 如果命中 P0 区间，给予核弹级权重 (+1000)
            if([7,8,9].includes(d19)) { w.b+=1000; isDictator=true; }
            else if([0,1,2].includes(d19)) { w.s+=1000; isDictator=true; }
            
            if([3,4,5,6].includes(d19)) {
                if((i19+n1+n2)%3===0) { w.o+=1000; isDictator=true; }
                else { w.e+=1000; isDictator=true; }
            }

            // --- P1: Algo 16 (几何) ---
            // 规则: 跳水状态下锁定 P0 独裁
            let r16 = Math.sqrt(n1*n2*(1+Math.abs(n1-n2)/C.SQRT_OSC)+C.SQRT_ADD);
            let d16 = KERNEL.getD(r16);
            let score16 = isDive ? 1000 : 50; // 跳水直接 +1000
            if(isDive) isDictator = true;
            
            if(d16>=5) w.b+=score16; else w.s+=score16;

            // --- P1: Algo 14 (裂变) ---
            // 规则: D 0-4 顺(买同), 5-9 裂(买反)
            // 必须对比上一期结果 (prevItem)
            if(prevItem) {
                let r14 = Math.sqrt(((n1-n2)**2) + ((n3**2)/(sum+1)) + C.FISS_GOLD);
                let d14 = KERNEL.getD(r14);
                let w14 = 40; // 权重高一点
                
                let prevBs = prevItem.sum >= 14 ? 'Big' : 'Small';
                
                if(d14<=4) { 
                    // 顺: 上期是大，这期加注大
                    if(prevBs==='Big') w.b+=w14; else w.s+=w14;
                } else {
                    // 裂: 上期是大，这期加注小
                    if(prevBs==='Big') w.s+=w14; else w.b+=w14;
                }
            }

            // --- P2/P3: 常规堆叠 ---
            // Algo 18
            let r18 = ((n1+3.1415)*(n2+2.7182)*(n3+1.4142))/C.TRI_DIV;
            (Math.floor(r18)%10%2!==0) ? w.o+=30 : w.e+=30;
            
            // Algo 2
            let r2 = (n1+C.REV_GOLD)*C.REV_GOLD;
            (Math.floor(r2)%2===0) ? w.o+=30 : w.e+=30;

            // --- P4: Algo 10 (极值修正 - 否决权) ---
            // 规则: <0.333 反弹
            let r10 = 280/(n1+C.EXT_DIV);
            let dec10 = r10 - Math.floor(r10);
            if(dec10 < 0.333) {
                // 反弹 = 唱反调
                // 如果当前 大>小，强制扣除大的分数，或者给小加分
                // 这里使用惩罚机制，削弱当前优势方
                if(w.b > w.s) w.b *= 0.6; // 削弱40%
                else w.s *= 0.6;
            }

            // --- Algo 3 (警报 - 归零) ---
            let r3 = (n1+n2+n3)/C.WARN_DIV;
            let d3 = KERNEL.getD(r3);
            if(d3===0 || d3===6) {
                // 清空惯性: 所有权重归为底分
                w.b=1; w.s=1; w.o=1; w.e=1;
            }

            // --- 归一化 (10分制) ---
            let total = w.b+w.s+w.o+w.e;
            let nW = { 
                b: (w.b/total)*10, s: (w.s/total)*10, 
                o: (w.o/total)*10, e: (w.e/total)*10 
            };

            // 组合分
            let combos = [
                { name: "大单", s: w.b+w.o }, { name: "大双", s: w.b+w.e },
                { name: "小单", s: w.s+w.o }, { name: "小双", s: w.s+w.e }
            ];
            // 排序
            combos.sort((a,b) => b.s - a.s);
            
            // 归一化组合
            let cTotal = combos.reduce((a,b)=>a+b.s,0);
            let nCombos = combos.map(c => ({ name: c.name, s: (c.s/cTotal)*10 }));

            return { nW, nCombos };
        }
    };

    // --- APP ---
    async function sync() {
        document.getElementById('timer').innerText = "SYNC...";
        try {
            const t = Date.now();
            const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(STATE.api + "&t=" + t)}`);
            const json = await res.json();
            const data = JSON.parse(json.contents).data;
            if(data && data.length > 0) {
                STATE.history = data.map(i => {
                    const nums = i.opennum.split('+').map(Number);
                    return { q: i.qihao, n1: nums[0], n2: nums[1], n3: nums[2], sum: parseInt(i.sum) };
                });
                render();
            }
        } catch(e) { console.error(e); }
        startTimer();
    }

    function render() {
        const list = STATE.history;
        if(list.length < 5) return;

        const cur = list[0];
        const prev = list[1]; // 用于 Algo 14 对比

        // 1. 本期预测
        const res = KERNEL.run(cur.n1, cur.n2, cur.n3, cur.sum, prev, list);
        
        // 补偿死磕逻辑
        let revenge = localStorage.getItem('v7_revenge');
        if(revenge) {
            // 如果有复仇目标，检查它是否在杀组(idx 3)或防守(idx 2)
            // 强制提权到主力
            let idx = res.nCombos.findIndex(c => c.name === revenge);
            if(idx >= 2) {
                // 强行交换到第一名
                let tmp = res.nCombos[0];
                res.nCombos[0] = res.nCombos[idx];
                res.nCombos[idx] = tmp;
            }
        }

        document.getElementById('tMain').innerText = `${res.nCombos[0].name} / ${res.nCombos[1].name}`;
        document.getElementById('tDef').innerText = res.nCombos[2].name;
        document.getElementById('tKill').innerText = res.nCombos[3].name;

        // 渲染条
        const draw = (id, val) => {
            document.getElementById('b'+id).style.width = Math.min(100, val*10) + '%';
            document.getElementById('v'+id).innerText = val.toFixed(1);
        };
        draw('Big', res.nW.b); draw('Sml', res.nW.s);
        draw('Odd', res.nW.o); draw('Evn', res.nW.e);

        for(let i=0; i<4; i++) {
            document.getElementById(`cN${i+1}`).innerText = res.nCombos[i].name;
            document.getElementById(`cV${i+1}`).innerText = res.nCombos[i].s.toFixed(1);
        }

        // 渲染复盘
        const hBox = document.getElementById('histList');
        hBox.innerHTML = '';
        
        let lastHit = false;
        let lastMain = '';

        for(let i=0; i<10; i++) {
            const t = list[i]; // 目标
            const p = list[i+1]; // 输入
            const pp = list[i+2]; // 上上期(Algo14用)

            const sim = KERNEL.run(p.n1, p.n2, p.n3, p.sum, pp, list);
            
            const real = (t.sum>=14?'大':'小') + (t.sum%2!==0?'单':'双');
            if(i===0) lastMain = sim.nCombos[0].name;

            let tag = ''; let cls = '';
            // 命中: 主攻前2
            if(sim.nCombos[0].name === real || sim.nCombos[1].name === real) {
                tag = '命中'; cls = 'hit';
                if(i===0) lastHit = true;
            } 
            // 防守: 第3
            else if(sim.nCombos[2].name === real) {
                tag = '防守'; cls = 'def';
            } 
            // 偏离: 杀组
            else {
                tag = '偏离'; cls = 'miss';
            }

            hBox.innerHTML += `
                <div class="hist-item">
                    <div><b>${t.q.slice(-4)}期</b> <span style="color:#8e8e93; margin-left:5px">[${t.sum}] ${real}</span></div>
                    <div class="tag ${cls}">${tag}</div>
                </div>`;
        }

        // 设置复仇
        if(!lastHit) {
            // 没中，下把死磕这个方向
            localStorage.setItem('v7_revenge', lastMain);
        } else {
            localStorage.removeItem('v7_revenge');
        }
    }

    function startTimer() {
        let t = STATE.refresh;
        const tmr = setInterval(() => {
            t--;
            document.getElementById('timer').innerText = `NEXT ${t}s`;
            if(t<=0) { clearInterval(tmr); sync(); }
        }, 1000);
    }

    window.onload = sync;
</script>
</body>
</html>
