<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GEMINI V7.0 [PRO DARK]</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #050505;
            --bg-card: rgba(20, 20, 23, 0.7);
            --bg-glass: rgba(255, 255, 255, 0.03);
            --border-glass: rgba(255, 255, 255, 0.08);
            
            --primary: #3b82f6; /* 蓝 - 主攻 */
            --accent: #f59e0b;  /* 黄 - 防守 */
            --danger: #ef4444;  /* 红 - 杀/大 */
            --success: #10b981; /* 绿 - 小 */
            --purple: #8b5cf6;  /* 紫 - 单 */
            --cyan: #06b6d4;    /* 青 - 双 */
            
            --text-main: #e2e8f0;
            --text-sub: #64748b;
            
            --font-num: 'JetBrains Mono', monospace;
            --font-ui: 'Inter', sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(139, 92, 246, 0.1) 0%, transparent 40%);
            color: var(--text-main);
            font-family: var(--font-ui);
            margin: 0; padding: 20px 16px 40px 16px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 24px; }

        /* --- Header --- */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .brand { 
            font-size: 1.25rem; font-weight: 800; letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            display: flex; align-items: center; gap: 8px;
        }
        .brand::before { content:''; display:block; width:4px; height:16px; background:var(--primary); border-radius:2px; }
        
        .status-badge { 
            font-family: var(--font-num); font-size: 0.75rem; 
            padding: 4px 12px; border-radius: 99px;
            background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2);
            color: var(--success); display: flex; align-items: center; gap: 6px;
        }
        .pulse-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: pulse 2s infinite; }

        /* --- Glass Cards --- */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 24px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }
        
        .card-label {
            position: absolute; top: 16px; left: 24px;
            font-size: 0.7rem; font-weight: 700; color: var(--text-sub);
            letter-spacing: 1px; text-transform: uppercase;
        }
        .card-deco {
            position: absolute; top: 0; right: 0;
            width: 100px; height: 100px;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.05), transparent 70%);
            pointer-events: none;
        }

        /* --- Tactical Core (Main Display) --- */
        .tac-grid { margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        
        .tac-box {
            background: var(--bg-glass); border-radius: 16px; padding: 16px;
            display: flex; flex-direction: column; align-items: center;
            border: 1px solid var(--border-glass);
        }
        .tac-box.main { border-color: rgba(59, 130, 246, 0.3); background: radial-gradient(circle at center, rgba(59,130,246,0.1), transparent); }
        .tac-box.kill { border-color: rgba(239, 68, 68, 0.15); opacity: 0.8; }
        
        .tac-title { font-size: 0.75rem; color: var(--text-sub); margin-bottom: 8px; }
        .tac-val { 
            font-family: var(--font-num); font-size: 1.5rem; font-weight: 800; 
            letter-spacing: -1px; text-shadow: 0 0 20px rgba(255,255,255,0.1);
        }

        .c-main { color: var(--primary); }
        .c-def { color: var(--accent); }
        .c-kill { color: var(--text-sub); text-decoration: line-through; text-decoration-thickness: 2px; text-decoration-color: var(--danger); opacity: 0.5; }

        /* --- Energy Bars (HUD Style) --- */
        .hud-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px 12px; margin-top: 25px; }
        
        .hud-item { display: flex; flex-direction: column; gap: 6px; }
        .hud-head { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 600; color: var(--text-sub); }
        .hud-track {
            height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; position: relative;
        }
        .hud-bar {
            height: 100%; border-radius: 3px; position: relative;
            box-shadow: 0 0 10px currentColor; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Combo Mini Grid */
        .combo-row { 
            display: flex; justify-content: space-between; 
            margin-top: 20px; padding-top: 15px; 
            border-top: 1px solid var(--border-glass); 
        }
        .mini-stat { text-align: center; }
        .ms-label { font-size: 0.65rem; color: var(--text-sub); margin-bottom: 4px; }
        .ms-val { font-family: var(--font-num); font-weight: 700; font-size: 0.9rem; }

        /* --- History (Terminal Style) --- */
        #histList { margin-top: 25px; display: flex; flex-direction: column; gap: 8px; }
        .log-row {
            display: grid; grid-template-columns: 60px 1fr 50px; align-items: center;
            padding: 10px 12px; border-radius: 8px;
            background: rgba(0,0,0,0.2); border: 1px solid transparent;
            font-size: 0.85rem; font-family: var(--font-num);
            transition: all 0.2s;
        }
        .log-row:first-child { 
            background: rgba(59, 130, 246, 0.08); 
            border-color: rgba(59, 130, 246, 0.2); 
        }
        
        .log-q { color: var(--text-sub); }
        .log-r { font-weight: 700; color: var(--text-main); text-align: center; }
        .log-res { font-weight: 800; text-align: right; font-size: 0.75rem; }

        .tag-hit { color: var(--success); text-shadow: 0 0 10px rgba(16,185,129,0.4); }
        .tag-def { color: var(--accent); }
        .tag-miss { color: var(--danger); opacity: 0.5; }

        /* --- Analytics Grid --- */
        .stat-hex-grid {
            margin-top: 25px;
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
        }
        .hex-item {
            background: rgba(255,255,255,0.02); border-radius: 12px;
            padding: 12px 0; text-align: center;
            border: 1px solid var(--border-glass);
        }
        .hex-t { font-size: 0.65rem; color: var(--text-sub); margin-bottom: 4px; display: block; }
        .hex-v { font-family: var(--font-num); font-size: 1rem; font-weight: 800; color: var(--text-main); }
        .h-high { color: var(--primary); }

        /* Animation */
        @keyframes pulse { 0% { opacity:0.4; } 50% { opacity:1; box-shadow:0 0 10px var(--success); } 100% { opacity:0.4; } }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header">
        <div class="brand">GEMINI <span style="font-weight:400; opacity:0.5; margin-left:5px; font-size:0.8em">PRO</span></div>
        <div class="status-badge"><div class="pulse-dot"></div> <span id="timer">SYNCING</span></div>
    </div>

    <div class="card">
        <div class="card-deco"></div>
        <span class="card-label">TACTICAL CORE // 战术核心</span>
        
        <div class="tac-grid">
            <div class="tac-box main" style="grid-column: span 2">
                <span class="tac-title">PRIORITY TARGET (主攻)</span>
                <div id="tMain" class="tac-val c-main">-- / --</div>
            </div>
            <div class="tac-box">
                <span class="tac-title">DEFENSE (防守)</span>
                <div id="tDef" class="tac-val c-def">--</div>
            </div>
            <div class="tac-box kill">
                <span class="tac-title">KILL (杀组)</span>
                <div id="tKill" class="tac-val c-kill">--</div>
            </div>
        </div>
    </div>

    <div class="card">
        <span class="card-label">ENERGY MATRIX // 能量矩阵</span>
        
        <div class="hud-grid">
            <div class="hud-item">
                <div class="hud-head"><span>大 (BIG)</span> <span id="vBig">0.0</span></div>
                <div class="hud-track"><div id="bBig" class="hud-bar" style="width:0%; background:var(--danger)"></div></div>
            </div>
            <div class="hud-item">
                <div class="hud-head"><span>小 (SML)</span> <span id="vSml">0.0</span></div>
                <div class="hud-track"><div id="bSml" class="hud-bar" style="width:0%; background:var(--success)"></div></div>
            </div>
            <div class="hud-item">
                <div class="hud-head"><span>单 (ODD)</span> <span id="vOdd">0.0</span></div>
                <div class="hud-track"><div id="bOdd" class="hud-bar" style="width:0%; background:var(--purple)"></div></div>
            </div>
            <div class="hud-item">
                <div class="hud-head"><span>双 (EVN)</span> <span id="vEvn">0.0</span></div>
                <div class="hud-track"><div id="bEvn" class="hud-bar" style="width:0%; background:var(--cyan)"></div></div>
            </div>
        </div>

        <div class="combo-row">
            <div class="mini-stat"><div class="ms-label" id="cN1">--</div><div class="ms-val c-main" id="cV1">--</div></div>
            <div class="mini-stat"><div class="ms-label" id="cN2">--</div><div class="ms-val c-main" id="cV2">--</div></div>
            <div class="mini-stat"><div class="ms-label" id="cN3">--</div><div class="ms-val c-def" id="cV3">--</div></div>
            <div class="mini-stat"><div class="ms-label" id="cN4">--</div><div class="ms-val c-kill" id="cV4">--</div></div>
        </div>
    </div>

    <div class="card">
        <span class="card-label">TERMINAL LOG // 近10期记录</span>
        <div id="histList"></div>
    </div>

    <div class="card" style="padding-bottom: 30px;">
        <span class="card-label">ANALYTICS // 全局数据</span>
        <div class="stat-hex-grid">
            <div class="hex-item"><span class="hex-t">综合胜率</span><span id="acc-total" class="hex-v h-high">--%</span></div>
            <div class="hex-item"><span class="hex-t">主攻命中</span><span id="acc-main" class="hex-v h-high">--%</span></div>
            <div class="hex-item"><span class="hex-t">杀组成功</span><span id="acc-kill" class="hex-v">--%</span></div>
            <div class="hex-item"><span class="hex-t">大小准确</span><span id="acc-bs" class="hex-v">--%</span></div>
            <div class="hex-item"><span class="hex-t">单双准确</span><span id="acc-oe" class="hex-v">--%</span></div>
            <div class="hex-item"><span class="hex-t">防守命中</span><span id="acc-def" class="hex-v">--%</span></div>
        </div>
    </div>

</div>

<script>
    // --- 1. 指令集常量 ---
    const C = {
        SQRT_OSC: 28.5, SQRT_ADD: 7.5515, FISS_GOLD: 1.6180, SCAL_GOLD: 3.81966,
        TRI_DIV: 42.75, REV_GOLD: 0.61803, WARN_DIV: 6.6666, EXT_DIV: 2.2222
    };

    const STATE = {
        // 修正：限制改为 20，提高速度
        api: "https://pc28.help/kj.json?limit=20",
        history: [],
        refresh: 15 // 刷新频率
    };

    const KERNEL = {
        getD: (n) => parseInt(n.toFixed(6).split('.')[1][0]),
        
        run: (n1, n2, n3, sum, prevItem, history) => {
            // 修正：底分稍微给高一点点，并加入确定性微扰动，防止0和相等
            // 扰动因子基于 (n1+n2+n3) 生成，保证同数据下结果一致，但不同数据间有差异
            let seed = (n1 + n2 * 1.1 + n3 * 1.2) * 0.001; 
            
            // 基础底分不再是1，而是带有微小差异的底数
            let w = { 
                b: 10 + seed, 
                s: 10 - seed, 
                o: 10 + (seed * 1.5), 
                e: 10 - (seed * 1.5) 
            }; 

            let isDive = Math.abs(n1-n2) > 8;
            
            // --- Algo 19 (手术刀) ---
            let r19 = (Math.sqrt(n1**2+n2**2+n3**2))/C.SCAL_GOLD;
            let d19 = KERNEL.getD(r19);
            let i19 = Math.floor(r19);
            
            if([7,8,9].includes(d19)) { w.b+=1000; }
            else if([0,1,2].includes(d19)) { w.s+=1000; }
            
            if([3,4,5,6].includes(d19)) {
                if((i19+n1+n2)%3===0) { w.o+=1000; }
                else { w.e+=1000; }
            }

            // --- Algo 16 (几何) ---
            let r16 = Math.sqrt(n1*n2*(1+Math.abs(n1-n2)/C.SQRT_OSC)+C.SQRT_ADD);
            let d16 = KERNEL.getD(r16);
            let score16 = isDive ? 1000 : 50; 
            
            if(d16>=5) w.b+=score16; else w.s+=score16;

            // --- Algo 14 (裂变) ---
            if(prevItem) {
                let r14 = Math.sqrt(((n1-n2)**2) + ((n3**2)/(sum+1)) + C.FISS_GOLD);
                let d14 = KERNEL.getD(r14);
                let w14 = 40; 
                let prevBs = prevItem.sum >= 14 ? 'Big' : 'Small';
                if(d14<=4) { 
                    if(prevBs==='Big') w.b+=w14; else w.s+=w14;
                } else {
                    if(prevBs==='Big') w.s+=w14; else w.b+=w14;
                }
            }

            // --- 常规堆叠 ---
            let r18 = ((n1+3.1415)*(n2+2.7182)*(n3+1.4142))/C.TRI_DIV;
            (Math.floor(r18)%10%2!==0) ? w.o+=30 : w.e+=30;
            
            let r2 = (n1+C.REV_GOLD)*C.REV_GOLD;
            (Math.floor(r2)%2===0) ? w.o+=30 : w.e+=30;

            // --- Algo 10 (极值修正) ---
            let r10 = 280/(n1+C.EXT_DIV);
            let dec10 = r10 - Math.floor(r10);
            if(dec10 < 0.333) {
                if(w.b > w.s) w.b *= 0.6; else w.s *= 0.6;
            }

            // --- Algo 3 (警报) ---
            let r3 = (n1+n2+n3)/C.WARN_DIV;
            let d3 = KERNEL.getD(r3);
            if(d3===0 || d3===6) {
                // 警报时保持基础底分差异
                w.b=10+seed; w.s=10-seed; w.o=10+seed; w.e=10-seed;
            }

            // --- 归一化处理 ---
            let total = w.b+w.s+w.o+w.e;
            // 防止total极小
            if(total < 1) total = 1;

            let nW = { 
                b: (w.b/total)*10, s: (w.s/total)*10, 
                o: (w.o/total)*10, e: (w.e/total)*10 
            };

            // 组合分计算
            let combos = [
                { name: "大单", s: w.b+w.o }, { name: "大双", s: w.b+w.e },
                { name: "小单", s: w.s+w.o }, { name: "小双", s: w.s+w.e }
            ];
            
            // 排序前加入微量因子，彻底解决同分排序不稳定的问题
            combos.forEach((c, idx) => {
                c.s += (idx * 0.001); // 极其微小的偏移，确保sort稳定
            });

            combos.sort((a,b) => b.s - a.s);
            
            let cTotal = combos.reduce((a,b)=>a+b.s,0);
            if(cTotal < 1) cTotal = 1;
            let nCombos = combos.map(c => ({ name: c.name, s: (c.s/cTotal)*10 }));

            return { nW, nCombos };
        }
    };

    // --- APP Logic ---
    async function sync() {
        document.getElementById('timer').innerText = "DATA SYNC";
        document.querySelector('.pulse-dot').style.background = "#eab308"; // Loading Yellow

        try {
            const t = Date.now();
            const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(STATE.api + "&t=" + t)}`);
            const json = await res.json();
            const data = JSON.parse(json.contents).data;
            if(data && data.length > 0) {
                STATE.history = data.map(i => {
                    const nums = i.opennum.split('+').map(Number);
                    return { q: i.qihao, n1: nums[0], n2: nums[1], n3: nums[2], sum: parseInt(i.sum) };
                });
                render();
                document.querySelector('.pulse-dot').style.background = "#10b981"; // Success Green
            }
        } catch(e) { 
            console.error(e); 
            document.querySelector('.pulse-dot').style.background = "#ef4444"; // Error Red
        }
        startTimer();
    }

    function render() {
        const list = STATE.history;
        if(list.length < 5) return;

        const cur = list[0];
        const prev = list[1]; 

        // 1. 本期预测
        const res = KERNEL.run(cur.n1, cur.n2, cur.n3, cur.sum, prev, list);
        
        // 2. 复仇逻辑
        let revenge = localStorage.getItem('v7_pro_revenge');
        if(revenge) {
            let idx = res.nCombos.findIndex(c => c.name === revenge);
            if(idx >= 2) {
                // 如果复仇对象在后排，强行提至第一位，并交换权重显示
                let tmp = res.nCombos[0];
                res.nCombos[0] = res.nCombos[idx];
                res.nCombos[idx] = tmp;
            }
        }

        // 3. UI 更新
        document.getElementById('tMain').innerHTML = `<span style="color:var(--primary)">${res.nCombos[0].name}</span> <span style="font-size:0.6em;opacity:0.5;margin:0 4px">/</span> <span style="color:rgba(255,255,255,0.7)">${res.nCombos[1].name}</span>`;
        document.getElementById('tDef').innerText = res.nCombos[2].name;
        document.getElementById('tKill').innerText = res.nCombos[3].name;

        const draw = (id, val) => {
            // 确保显示不为0.0，如果非常小但非0，显示 <0.1
            let disp = val.toFixed(1);
            if(val > 0 && disp === "0.0") disp = "0.1";
            
            document.getElementById('b'+id).style.width = Math.min(100, val*10) + '%';
            document.getElementById('v'+id).innerText = disp;
        };
        draw('Big', res.nW.b); draw('Sml', res.nW.s);
        draw('Odd', res.nW.o); draw('Evn', res.nW.e);

        for(let i=0; i<4; i++) {
            document.getElementById(`cN${i+1}`).innerText = res.nCombos[i].name;
            document.getElementById(`cV${i+1}`).innerText = res.nCombos[i].s.toFixed(1);
        }

        // 4. 历史复盘 (Terminal Style)
        const hBox = document.getElementById('histList');
        hBox.innerHTML = '';
        
        let lastHit = false;
        let lastMain = '';

        for(let i=0; i<10; i++) {
            const t = list[i]; 
            const p = list[i+1]; 
            const pp = list[i+2]; 

            const sim = KERNEL.run(p.n1, p.n2, p.n3, p.sum, pp, list);
            const real = (t.sum>=14?'大':'小') + (t.sum%2!==0?'单':'双');
            
            if(i===0) lastMain = sim.nCombos[0].name;

            let tag = ''; let cls = '';
            if(sim.nCombos[0].name === real || sim.nCombos[1].name === real) {
                tag = 'HIT'; cls = 'tag-hit';
                if(i===0) lastHit = true;
            } 
            else if(sim.nCombos[2].name === real) {
                tag = 'DEF'; cls = 'tag-def';
            } 
            else {
                tag = 'MISS'; cls = 'tag-miss';
            }

            hBox.innerHTML += `
                <div class="log-row">
                    <div class="log-q">${t.q.slice(-4)}</div>
                    <div class="log-r">${real} <span style="opacity:0.4; font-size:0.8em">[${t.sum}]</span></div>
                    <div class="log-res ${cls}">${tag}</div>
                </div>`;
        }

        if(!lastHit) localStorage.setItem('v7_pro_revenge', lastMain);
        else localStorage.removeItem('v7_pro_revenge');

        // 5. 计算六维准确率
        calculateStats(list);
    }

    function calculateStats(list) {
        let stats = { bs: 0, oe: 0, main: 0, def: 0, kill: 0, total: 0 };

        // 统计所有拉取到的数据（减去头部不需要预测的）
        for(let i = 0; i < list.length - 2; i++) {
            const target = list[i];
            const input = list[i+1];
            const prev = list[i+2];

            const sim = KERNEL.run(input.n1, input.n2, input.n3, input.sum, prev, list);
            
            const realBig = target.sum >= 14;
            const realOdd = target.sum % 2 !== 0;
            const realCombo = (realBig?'大':'小') + (realOdd?'单':'双');

            stats.total++;
            if((sim.nW.b > sim.nW.s) === realBig) stats.bs++;
            if((sim.nW.o > sim.nW.e) === realOdd) stats.oe++;
            if(sim.nCombos[0].name === realCombo || sim.nCombos[1].name === realCombo) stats.main++;
            if(sim.nCombos[2].name === realCombo) stats.def++;
            if(sim.nCombos[3].name !== realCombo) stats.kill++;
        }

        const calc = (v) => Math.round((v / stats.total) * 100) + "%";
        document.getElementById('acc-bs').innerText = calc(stats.bs);
        document.getElementById('acc-oe').innerText = calc(stats.oe);
        document.getElementById('acc-main').innerText = calc(stats.main);
        document.getElementById('acc-def').innerText = calc(stats.def);
        document.getElementById('acc-kill').innerText = calc(stats.kill);
        document.getElementById('acc-total').innerText = calc(stats.main + stats.def);
    }

    function startTimer() {
        let t = STATE.refresh;
        const tmr = setInterval(() => {
            t--;
            document.getElementById('timer').innerText = `NEXT ${t}s`;
            if(t<=0) { clearInterval(tmr); sync(); }
        }, 1000);
    }

    window.onload = sync;
</script>
</body>
</html>
