<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gemini V5 [RAW KERNEL]</title>
    <style>
        :root {
            --bg: #f0f2f5;
            --card: #ffffff;
            --text-main: #1d1d1f;
            --text-sub: #86868b;
            --red: #ff3b30;
            --green: #34c759;
            --blue: #007aff;
            --gold: #ffcc00;
            --shadow: 0 4px 12px rgba(0,0,0,0.06);
            --radius: 16px;
        }

        body {
            background: var(--bg);
            color: var(--text-main);
            font-family: -apple-system, "SF Pro Text", monospace;
            margin: 0; padding: 16px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container { width: 100%; max-width: 440px; display: flex; flex-direction: column; gap: 16px; }

        /* çŠ¶æ€æ  */
        .header { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-sub); }
        .badge { padding: 4px 8px; border-radius: 6px; font-weight: 700; font-size: 11px; }
        .b-live { background: var(--green); color: white; }
        .b-warn { background: var(--red); color: white; animation: pulse 1s infinite; }

        /* å¡ç‰‡ */
        .card { background: var(--card); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); position: relative; }
        .card-head { font-size: 13px; font-weight: 600; color: var(--text-sub); margin-bottom: 10px; display: flex; justify-content: space-between; }

        /* æ ¸å¿ƒæˆ˜ä»¤ */
        .cmd-box { text-align: center; padding: 10px 0; }
        .cmd-val { font-size: 42px; font-weight: 900; line-height: 1; letter-spacing: -1px; }
        .cmd-sub { font-size: 14px; margin-top: 5px; color: var(--text-sub); }
        .conf-bar { height: 4px; background: #eee; width: 60%; margin: 10px auto 0; border-radius: 2px; overflow: hidden; }
        .conf-fill { height: 100%; background: var(--blue); width: 0%; transition: width 0.5s; }

        /* æ·±åº¦è§£ææ–‡æœ¬ (Terminal é£æ ¼) */
        .terminal {
            background: #1c1c1e; color: #00ff41; 
            font-family: 'Menlo', 'Courier New', monospace;
            font-size: 10px; line-height: 1.4;
            padding: 12px; border-radius: 8px;
            height: 150px; overflow-y: auto;
            white-space: pre-wrap;
        }

        /* ç®—æ³•çŸ©é˜µè¡¨ */
        .matrix-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-top: 5px; }
        .algo-cell { background: #f5f5f7; padding: 6px 2px; text-align: center; border-radius: 4px; }
        .algo-id { font-size: 9px; color: #888; }
        .algo-res { font-size: 11px; font-weight: bold; color: #333; margin-top: 2px; }
        .p0-active { background: rgba(255, 59, 48, 0.1); border: 1px solid var(--red); }

        /* æƒé‡æ¡ */
        .stat-row { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; }
        .stat-lbl { width: 30px; font-weight: 600; }
        .stat-track { flex: 1; height: 6px; background: #eee; border-radius: 3px; margin: 0 8px; overflow: hidden; }
        .stat-fill { height: 100%; border-radius: 3px; }
        .stat-val { width: 25px; text-align: right; font-family: monospace; }

        /* å†å² */
        .hist-row { display: flex; justify-content: space-between; font-size: 12px; padding: 6px 0; border-bottom: 1px solid #f0f0f0; }
        .tag { padding: 2px 4px; border-radius: 3px; font-size: 10px; font-weight: 700; margin-left: 4px; }
        .tag.win { background: rgba(52, 199, 89, 0.2); color: var(--green); }
        .tag.loss { background: rgba(255, 59, 48, 0.2); color: var(--red); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>Gemini-Scalpel V5.0 <span class="badge b-live">KERNEL ACTIVE</span></div>
        <div id="countdown">--s</div>
    </div>
    
    <div style="height:2px; background:#e5e5ea; width:100%; border-radius:1px;">
        <div id="loadBar" style="height:100%; background:var(--blue); width:0%;"></div>
    </div>

    <div class="card">
        <div class="card-head">
            <span>ç¬¬ <span id="nextIssue" style="color:var(--blue)">--</span> æœŸ æ ¸å¿ƒæˆ˜ä»¤</span>
            <span id="stateLabel" style="font-size:11px; color:var(--text-sub)">å¸¸è§„æ€</span>
        </div>
        <div class="cmd-box">
            <div class="cmd-val" id="finalCmd">--</div>
            <div class="cmd-sub" id="finalDetail">ç­‰å¾…åŸå§‹æ•°æ®æ³¨å…¥...</div>
            <div class="conf-bar"><div class="conf-fill" id="confBar"></div></div>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:15px; font-size:12px; text-align:center;">
            <div style="flex:1;">
                <div style="color:#888; font-size:10px;">ğŸ”¥ ä¸»æ”» (Main)</div>
                <div id="tacMain" style="font-weight:700; margin-top:2px;">--</div>
            </div>
            <div style="flex:1; border-left:1px solid #eee;">
                <div style="color:#888; font-size:10px;">ğŸ›¡ï¸ é˜²å®ˆ (Def)</div>
                <div id="tacDef" style="font-weight:700; margin-top:2px;">--</div>
            </div>
            <div style="flex:1; border-left:1px solid #eee;">
                <div style="color:#888; font-size:10px;">ğŸ’€ æ€ç»„ (Kill)</div>
                <div id="tacKill" style="font-weight:700; margin-top:2px; color:#aaa; text-decoration:line-through;">--</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-head">ä¸ƒå‰‘ç®—æ³•çŸ©é˜µ (128-Bit Precision)</div>
        <div class="matrix-grid" id="matrixBoard">
            </div>
        <div style="margin-top:10px; padding-top:10px; border-top:1px solid #eee;">
            <div class="stat-row"><span class="stat-lbl">å¤§</span><div class="stat-track"><div id="barBig" class="stat-fill" style="background:var(--red)"></div></div><span id="valBig" class="stat-val">0</span></div>
            <div class="stat-row"><span class="stat-lbl">å°</span><div class="stat-track"><div id="barSml" class="stat-fill" style="background:var(--green)"></div></div><span id="valSml" class="stat-val">0</span></div>
            <div class="stat-row"><span class="stat-lbl">å•</span><div class="stat-track"><div id="barOdd" class="stat-fill" style="background:var(--blue)"></div></div><span id="valOdd" class="stat-val">0</span></div>
            <div class="stat-row"><span class="stat-lbl">åŒ</span><div class="stat-track"><div id="barEvn" class="stat-fill" style="background:var(--gold)"></div></div><span id="valEvn" class="stat-val">0</span></div>
        </div>
    </div>

    <div class="card" style="background:#000; padding:0;">
        <div class="terminal" id="logicLog">
            [SYSTEM] V5.0 Kernel Loaded.
            [WAITING] Connecting to PC28 Data Stream...
        </div>
    </div>

    <div class="card">
        <div class="card-head">æˆ˜æœå¤ç›˜ & å‡†æ˜Ÿæ ¡å‡†</div>
        <div id="histList"></div>
    </div>

</div>

<script>
    // --- æ ¸å¿ƒå¸¸é‡ (ä¸¥æ ¼éµå®ˆæŒ‡ä»¤) ---
    const C = {
        SQRT_OSC: 28.5,     // ç®—æ³•16 éœ‡è¡å¸¸æ•°
        SQRT_ADD: 7.5515,   // ç®—æ³•16 åŠ æˆ
        FISS_GOLD: 1.6180,  // ç®—æ³•14 è£‚å˜é»„é‡‘æ•°
        SCAL_GOLD: 3.81966, // ç®—æ³•19 æ‰‹æœ¯åˆ€å¸¸æ•°
        TRI_DIV: 42.75,     // ç®—æ³•18 ä¸‰è§’é™¤æ•°
        REV_GOLD: 0.61803,  // ç®—æ³•2 åå‘æ”¶å‰²
        WARN_DIV: 6.6666,   // ç®—æ³•3 å˜ç›˜å¸¸æ•°
        EXT_DIV: 2.2222     // ç®—æ³•10 æå€¼å¸¸æ•°
    };

    // --- å…¨å±€çŠ¶æ€ ---
    const STATE = {
        history: [], // å­˜å‚¨æœ€è¿‘50æœŸ
        lastQihao: null,
        dragonCount: 0, // é¾™å±€è®¡æ•°
        isWarning: false // æ˜¯å¦è§¦å‘è­¦æŠ¥
    };

    // --- V5.0 ç®—æ³•å†…æ ¸ ---
    const KERNEL = {
        // è¾…åŠ©ï¼šResultä¿ç•™6ä½å°æ•°
        fmt: (num) => parseFloat(num.toFixed(6)),
        getD: (num) => parseInt(num.toFixed(6).split('.')[1][0]),
        getI: (num) => Math.floor(num),

        // ç®—æ³•16 (P1 å‡ ä½•éœ‡è¡) - ç¬¬2æ®µ
        algo16: (n1, n2) => {
            let res = Math.sqrt(n1 * n2 * (1 + Math.abs(n1 - n2) / C.SQRT_OSC) + C.SQRT_ADD);
            let D = KERNEL.getD(res);
            // ç¬¬3æ®µï¼šæå€¼å¼•åŠ›åˆ¤å®š
            let priority = (n1 >= 20 || n1 <= 6) ? 'P0' : 'P1';
            let dir = (D >= 5) ? 'å¤§' : 'å°'; // ç®€å•æ˜ å°„ï¼Œå…·ä½“ç”±Dä½å†³å®šé‡åŠ›æ–¹å‘
            return { id: 16, d: D, dir: dir, p: priority, name: 'éœ‡è¡' };
        },

        // ç®—æ³•14 (P1 å•åŒè£‚å˜) - ç¬¬4æ®µ
        algo14: (n1, n2, n3, n4) => {
            let res = Math.sqrt(Math.pow((n1 - n2), 2) + (Math.pow(n3, 2) / (n4 + 1)) + C.FISS_GOLD);
            let D = KERNEL.getD(res);
            let dir = (D >= 0 && D <= 4) ? 'é¡º' : 'è£‚'; // 0-4é¡º(åŒ), 5-9è£‚(å)
            return { id: 14, d: D, dir: dir, p: 'P1', name: 'è£‚å˜' };
        },

        // ç®—æ³•19 (P0 æ‰‹æœ¯åˆ€) - ç¬¬5,6æ®µ
        algo19: (n1, n2, n3) => {
            let res = (Math.sqrt(n1**2 + n2**2 + n3**2)) / C.SCAL_GOLD;
            let D = KERNEL.getD(res);
            let I = KERNEL.getI(res);
            
            // å¤§å°åˆ¤å®š
            let size = 'ä¸­';
            if ([0,1,2].includes(D)) size = 'å°';
            if ([7,8,9].includes(D)) size = 'å¤§';

            // ç†µåˆ¤å®š (ç¬¬6æ®µ)
            let oe = null;
            if ([3,4,5,6].includes(D)) {
                let check = (I + n1 + n2) % 3;
                oe = (check === 0) ? 'å•' : 'åŒ';
            }
            return { id: 19, d: D, size: size, oe: oe, p: 'P0', name: 'æ‰‹æœ¯åˆ€' };
        },

        // ç®—æ³•18 (P2 ä¸‰è§’åŠ¨é‡) - ç¬¬7æ®µ
        algo18: (n1, n2, n3) => {
            let res = ((n1 + 3.1415) * (n2 + 2.7182) * (n3 + 1.4142)) / C.TRI_DIV;
            let D = KERNEL.getD(res);
            let U = Math.floor(res) % 10;
            return { id: 18, d: D, dirSize: (D>=5?'å¤§':'å°'), dirOe: (U%2!==0?'å•':'åŒ'), p: 'P2', name: 'åŠ¨é‡' };
        },

        // ç®—æ³•2 (P3 é»„é‡‘åå‘) - ç¬¬8æ®µ
        algo2: (n1) => {
            let res = (n1 + C.REV_GOLD) * C.REV_GOLD;
            let I = Math.floor(res);
            // å¶æ•°ä¹°å•ï¼Œå¥‡æ•°ä¹°åŒ (åå¿ƒç†)
            return { id: 2, d: KERNEL.getD(res), dir: (I%2===0?'å•':'åŒ'), p: 'P3', name: 'åå‰²' };
        },

        // ç®—æ³•3 (P3 å˜ç›˜é¢„è­¦) - ç¬¬9æ®µ
        algo3: (n1, n2, n3) => {
            let res = (n1 + n2 + n3) / C.WARN_DIV;
            let D = KERNEL.getD(res);
            let signal = 'å¸¸';
            if (D === 0 || D === 6) signal = 'è­¦'; // è§¦å‘åè¶‹åŠ¿è­¦æŠ¥
            return { id: 3, d: D, sig: signal, p: 'P3', name: 'é¢„è­¦' };
        },

        // ç®—æ³•10 (P4 æå€¼å€’æ•°) - ç¬¬10æ®µ
        algo10: (n1) => { // ä¸¥æ ¼æŒ‰ç…§æŒ‡ä»¤ï¼š280 / (N1 + 2.2222)
            let res = 280 / (n1 + C.EXT_DIV);
            let dec = res - Math.floor(res); // å°æ•°ä½
            let action = 'éœ‡';
            if (dec < 0.333) action = 'å¼¹'; // åå¼¹
            if (dec > 0.666) action = 'ç»­'; // å»¶ç»­
            return { id: 10, d: dec.toFixed(2), act: action, p: 'P4', name: 'ä¿®æ­£' };
        }
    };

    // --- æˆ˜æœ¯æŒ‡æŒ¥å®˜ (é€»è¾‘ç»¼åˆ) ---
    function analyzeTactics(lastItem, prevItem, history) {
        const { n1, n2, n3, sum } = lastItem;
        let logs = [];
        let w = { b: 0, s: 0, o: 0, e: 0 };
        
        logs.push(`>> [åˆå§‹åŒ–] è½½å…¥æœŸå· ${lastItem.q}, æ•°æ® ${n1}+${n2}+${n3}=${sum}`);

        // 1. è¿è¡Œç®—æ³•çŸ©é˜µ
        const r16 = KERNEL.algo16(n1, n2);
        const r14 = KERNEL.algo14(n1, n2, n3, sum); // N4ç”¨Sum
        const r19 = KERNEL.algo19(n1, n2, n3);
        const r18 = KERNEL.algo18(n1, n2, n3);
        const r2  = KERNEL.algo2(n1);
        const r3  = KERNEL.algo3(n1, n2, n3);
        const r10 = KERNEL.algo10(n1); // ä¸¥æ ¼ç”¨N1

        // 2. çŠ¶æ€åˆ¤å®š (ç¬¬11æ®µ)
        let isDragon = false; // éœ€ç»“åˆå†å²åˆ¤æ–­(æ­¤å¤„ç®€åŒ–æ¼”ç¤º)
        let isDiving = Math.abs(n1 - n2) > 8;
        let isAlarm = (r3.sig === 'è­¦');

        // 3. æƒé‡åˆ†é…
        // [P0] ç®—æ³•19
        if (r19.size === 'å¤§') w.b += 10;
        if (r19.size === 'å°') w.s += 10;
        if (r19.oe === 'å•') w.o += 10;
        if (r19.oe === 'åŒ') w.e += 10;
        logs.push(`[Algo19] æ‰‹æœ¯åˆ€åˆ‡å…¥: ${r19.size}/${r19.oe || '-'} (P0é”å®š)`);

        // [P1] ç®—æ³•16
        let w16 = isDiving ? 10 : 5; // è·³æ°´æå‡æƒé™
        if (r16.dir === 'å¤§') w.b += w16; else w.s += w16;
        if (isDiving) logs.push(`[Algo16] æ£€æµ‹åˆ°è·³æ°´(Diff>8)ï¼Œæƒé™æå‡è‡³P0`);

        // [P1] ç®—æ³•14 (é¡º/è£‚)
        // ç®€åŒ–é€»è¾‘ï¼šé¡ºåˆ™åŠ åˆ†ç»™å½“å‰é«˜åˆ†é¡¹ï¼Œè£‚åˆ™ç»™ä½åˆ†é¡¹
        if (r14.dir === 'é¡º') logs.push(`[Algo14] é¡ºåŠ¿å½¢æ€ï¼Œèƒ½é‡å…±æŒ¯`); 
        else logs.push(`[Algo14] è£‚å˜å½¢æ€ï¼Œæ³¨æ„åè½¬`);

        // [P2] ç®—æ³•18
        if (r18.dirSize==='å¤§') w.b+=3; else w.s+=3;
        if (r18.dirOe==='å•') w.o+=3; else w.e+=3;

        // [P3] ç®—æ³•2
        if (r2.dir==='å•') w.o+=3; else w.e+=3;

        // [è­¦å‘Š] ç®—æ³•3 (ç¬¬9æ®µ)
        if (isAlarm) {
            logs.push(`[Algo3] âš ï¸ D=${r3.d} è§¦å‘åè¶‹åŠ¿è­¦æŠ¥ï¼å¼ºåˆ¶æ¸…ç©ºæƒ¯æ€§ï¼`);
            // ç­–ç•¥ï¼šæ‰€æœ‰åˆ†æ•°å‡åŠï¼Œæˆ–å¼ºåˆ¶å½’é›¶é‡ç®— (æ­¤å¤„æ‰§è¡Œå‡åŠ+æ ‡è®°)
            w.b *= 0.5; w.s *= 0.5; w.o *= 0.5; w.e *= 0.5;
            document.getElementById('stateLabel').innerText = "å˜ç›˜è­¦æŠ¥";
            document.getElementById('stateLabel').className = "badge b-warn";
        } else {
            document.getElementById('stateLabel').innerText = "ç³»ç»Ÿå¸¸è§„";
            document.getElementById('stateLabel').className = "badge b-live";
        }

        // [ä¿®æ­£] ç®—æ³•10 (ç¬¬10æ®µ)
        if (r10.act === 'å¼¹') {
            logs.push(`[Algo10] æä½ä½åå¼¹ä¿¡å·(D=${r10.d})ï¼Œé˜²å®ˆåå‘ï¼`);
            // ç®€å•å¯¹å†²é€»è¾‘
            if (w.b > w.s) w.s += 4; else w.b += 4;
        }

        // 4. ç¬¬14æ®µ ç›²åŒºæš´åŠ›æ ¡å‡† (7.5-8.5åˆ†æ®µ)
        // æ¨¡æ‹Ÿé€»è¾‘ï¼šå¦‚æœæœ€å¤§åˆ†å€¼åœ¨ 7-9 ä¹‹é—´ï¼Œå¼ºåˆ¶ mod 3
        let maxScore = Math.max(w.b, w.s, w.o, w.e);
        if (maxScore >= 7 && maxScore <= 9) {
            logs.push(`[V5.0] èƒ½é‡åœ¨æ­¤æ¶ˆå½¼é•¿åŒºï¼Œæ¿€æ´» MOD 3 å¼ºæ€...`);
            let killKey = (Math.floor(r19.d) + n1 + n2) % 3 === 0 ? 'o' : 'e';
            if (killKey === 'o') { w.o += 5; logs.push(`>> å¼ºæ€é”å®š: å•`); }
            else { w.e += 5; logs.push(`>> å¼ºæ€é”å®š: åŒ`); }
        }

        // 5. ç”Ÿæˆæˆ˜æœ¯ç»„åˆ (Main, Def, Kill)
        let combos = [
            { name: "å¤§å•", s: w.b + w.o },
            { name: "å¤§åŒ", s: w.b + w.e },
            { name: "å°å•", s: w.s + w.o },
            { name: "å°åŒ", s: w.s + w.e }
        ];
        combos.sort((a, b) => b.s - a.s);

        return {
            raw: [r16, r14, r19, r18, r2, r3, r10],
            weights: w,
            combos: combos,
            logs: logs
        };
    }

    // --- ç³»ç»Ÿ IO ---
    async function syncData() {
        // UI Loading
        document.getElementById('countdown').innerText = "SYNC...";
        
        try {
            const t = new Date().getTime();
            const res = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://pc28.help/kj.json?limit=50&t=' + t));
            const json = await res.json();
            const data = JSON.parse(json.contents).data;
            
            if (data && data.length > 0) {
                // è½¬æ¢æ•°æ®æ ¼å¼
                STATE.history = data.map(i => {
                    let nums = i.opennum.split('+').map(Number);
                    return { q: i.qihao, n1: nums[0], n2: nums[1], n3: nums[2], sum: parseInt(i.sum) };
                }); // APIè¿”å›æ˜¯å€’åºçš„ [æœ€æ–°, ä¸ŠæœŸ...]

                renderUI();
            }
        } catch(e) {
            document.getElementById('logicLog').innerText += "\n[ERR] è¿æ¥ä¸­æ–­ï¼Œé‡è¯•ä¸­...";
        }

        startTimer();
    }

    function renderUI() {
        const list = STATE.history;
        const cur = list[0]; // æœ€æ–°ä¸€æœŸ
        const prev = list[1]; // ä¸ŠæœŸ

        // 1. é¢„æµ‹ä¸‹ä¸€æœŸ (åŸºäº cur)
        const result = analyzeTactics(cur, prev, list);
        const nextQ = BigInt(cur.q) + 1n;

        // å¡«å……æˆ˜ä»¤
        document.getElementById('nextIssue').innerText = nextQ;
        const topCombo = result.combos[0];
        const defCombo = result.combos[2]; // ç¬¬3åä¸ºé˜²å®ˆ(å¯¹å†²ä½)
        const killCombo = result.combos[3];

        document.getElementById('finalCmd').innerText = topCombo.name.charAt(0); // å¤§/å°
        document.getElementById('finalDetail').innerText = `${topCombo.name} / ${result.combos[1].name}`;
        
        // ä¿¡å¿ƒæ¡
        let conf = Math.min(100, topCombo.s * 4);
        document.getElementById('confBar').style.width = conf + "%";

        document.getElementById('tacMain').innerText = topCombo.name;
        document.getElementById('tacDef').innerText = defCombo.name;
        document.getElementById('tacKill').innerText = killCombo.name;

        // å¡«å……çŸ©é˜µçœ‹æ¿
        const mBoard = document.getElementById('matrixBoard');
        mBoard.innerHTML = '';
        result.raw.forEach(r => {
            let activeClass = r.p === 'P0' ? 'p0-active' : '';
            let dispVal = r.d;
            if (r.id === 19) dispVal = r.d; // æ‰‹æœ¯åˆ€æ˜¾ç¤ºDä½
            mBoard.innerHTML += `
                <div class="algo-cell ${activeClass}">
                    <div class="algo-id">${r.id}</div>
                    <div class="algo-res">${dispVal}</div>
                </div>`;
        });

        // å¡«å……æƒé‡æ¡
        const w = result.weights;
        const setBar = (id, val) => {
            document.getElementById('bar'+id).style.width = Math.min(100, val*5) + '%';
            document.getElementById('val'+id).innerText = val.toFixed(0);
        };
        setBar('Big', w.b); setBar('Sml', w.s); setBar('Odd', w.o); setBar('Evn', w.e);

        // å¡«å……æ—¥å¿—
        const logBox = document.getElementById('logicLog');
        logBox.innerText = result.logs.join('\n');

        // æˆ˜æœå¤ç›˜ (ç”¨ prev é¢„æµ‹ cur)
        if (prev) {
            const pastRes = analyzeTactics(prev, list[2], list); // å¤ç›˜ä¸ŠæœŸ
            const actSum = cur.sum;
            const actBs = actSum >= 14 ? 'å¤§' : 'å°';
            const actOe = actSum % 2 !== 0 ? 'å•' : 'åŒ';
            const actName = actBs + actOe; // e.g. "å¤§å•"
            
            // ç®€å•åˆ¤å®šï¼šä¸»æ”»å‰ä¸¤ååŒ…å«ç»“æœå³ä¸ºèƒœ
            const hit = (pastRes.combos[0].name === actName || pastRes.combos[1].name === actName);
            
            const histDiv = document.getElementById('histList');
            // åªæ˜¾ç¤ºæœ€è¿‘5æœŸ
            let html = `<div class="hist-row">
                <span>${cur.q.slice(-4)}æœŸ [${cur.n1}+${cur.n2}+${cur.n3}=${cur.sum}]</span>
                <span>
                    ${actName} 
                    <span class="tag ${hit?'win':'loss'}">${hit?'å‘½ä¸­':'åç¦»'}</span>
                </span>
            </div>`;
            // è¿½åŠ æ—§å†å²
            histDiv.innerHTML = html + histDiv.innerHTML;
            if (histDiv.children.length > 5) histDiv.lastChild.remove();
        }
    }

    function startTimer() {
        let t = 20;
        const tmr = setInterval(() => {
            t--;
            document.getElementById('countdown').innerText = t + 's';
            document.getElementById('loadBar').style.width = ((20-t)/20)*100 + "%";
            if (t<=0) { clearInterval(tmr); syncData(); }
        }, 1000);
    }

    // Init
    syncData();

</script>
</body>
</html>
